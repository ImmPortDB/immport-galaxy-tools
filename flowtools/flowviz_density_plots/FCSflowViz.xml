<tool id="flowviz_density_plots" name="Generate stacked density plots" version="1.0">
  <description>for a set of FCS files</description>
  <requirements>
    <requirement type="package" version="1.5.0">ig-flowtools</requirement>
  </requirements>
  <stdio>
    <exit_code range="10" level="fatal" description="Please provide a comma separated list of channels to plot" />
    <exit_code range="11" level="fatal" description="Please provide numeric values for the list of channels to plot" />
    <exit_code range="12" level="fatal" description="The set of FCS files must have the same set of channels" />
  </stdio>
  <command><![CDATA[
      Rscript --slave --vanilla '$__tool_directory__/FCSflowViz.R' --args '${channels}' '${outpng}' $outformat '${outpdf}'
      #for $f in $input
        '${f}' '${f.name}'
      #end for
  ]]>
  </command>
  <inputs>
    <param format="fcs" name="input" type="data_collection" collection_type="list" label="FCS files Collection"/>
    <param name="channels" type="text" label="Markers to plot:" value="i.e.:1,3,4" help="By default, will plot all channels."/>
    <param name="outformat" type="select" label="Output PDF?">
      <option value="FALSE">No, thank you</option>
      <option value="TRUE">Yes, please</option>
    </param>
  </inputs>
  <outputs>
      <data format="pdf" name="outpdf" label="Stacked Density Plots from ${input.name}">
        <filter>outformat=="TRUE"</filter>
      </data>
      <data format="png" name="outpng" label="Stacked Density Plots from ${input.name}"/>
  </outputs>
  <tests>
    <test>
      <param name="input">
        <collection type="list">
          <element name="input1.fcs" value="input1.fcs"/>
          <element name="input2.fcs" value="input2.fcs"/>
          <element name="input3.fcs" value="input3.fcs"/>
        </collection>
      </param>
      <param name="channels" value="1,3"/>
      <param name="outformat" value="TRUE"/>
      <output name="outpdf" file="graph.pdf" compare="sim_size"/>
      <output name="outpng" file="graph.png" compare="sim_size"/>
    </test>
    <test>
      <param name="input">
        <collection type="list">
          <element name="input1.fcs" value="input1.fcs"/>
          <element name="input2.fcs" value="input2.fcs"/>
          <element name="input3.fcs" value="input3.fcs"/>
        </collection>
      </param>
      <param name="channels" value="i.e.:1,3,4"/>
      <param name="outformat" value="FALSE"/>
      <output name="outpng" file="graph2.png" compare="sim_size"/>
    </test>
  </tests>
  <help><![CDATA[
   This tool generates stacked 1D density plots using flowViz.

-----

**Input files**

This tool takes a collection of valid FCS files as input.

.. class:: warningmark

Each FCS file in the input data collection should have the SAME set of channels.

**Output files**

This tool generates stacked 1D density plots for each channel. A pdf file can optionally be generated.

class:: warningmark

PDF are larger files that may take some time to load. It might be faster to download the PDF output once generated to open it locally.

-----

**Example**

*Output*:

.. image:: ./static/images/flowtools/flowviz.png

-----

**flowViz reference**

Ellis B, Gentleman R, Hahne F, Le Meur N, Sarkar D and Jiang M (2017). flowViz: Visualization for flow cytometry. R package version 1.40.0.

  ]]>
  </help>
  <citations>
    <citation type="doi">10.1186/1471-2105-10-106</citation>
  </citations>
</tool>
